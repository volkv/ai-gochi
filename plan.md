# Детальный план доработки AI Gochi

## ЭТАП 1: Система шкал состояния питомца

### 1.1 Обновление модели данных
- **PetState.kt**: добавить `ANGER` в enum `EmotionType`
- **Color.kt**: добавить цвет `Anger = Color(0xFFFF4444)` (красный)
- **PetState.kt**: создать `angerState` в объекте `PetStates`

### 1.2 Создание компонента шкал
- **Создать `PetStatsBar.kt`**:
  - 5 горизонтальных прогресс-баров
  - Каждая шкала: название, цвет, текущее значение (0-100)
  - Анимация изменения значений
  - Иконки для каждой эмоции

### 1.3 Модель состояний питомца
- **Создать `PetStats.kt`**: data class с полями для всех 5 эмоций
- **Обновить EchoViewModel.kt**:
  - Добавить StateFlow для статистик питомца
  - Методы увеличения/уменьшения показателей
  - Логика влияния эмоций на шкалы

### 1.4 Интеграция в MainScreen
- Разместить PetStatsBar под питомцем
- Подключить к ViewModel
- Тестирование отображения

---

## ЭТАП 2: Система чата

### 2.1 Создание интерфейса чата
- **Создать `ChatInterface.kt`**:
  - Модальное окно во весь экран
  - Область сообщений с приветствием питомца
  - Поле ввода с кнопкой отправки
  - Кнопка "Демо ответ" для автозаполнения
  - Кнопка закрытия

### 2.2 Логика чата в ViewModel
- **Обновить EchoViewModel.kt**:
  - StateFlow для состояния чата (открыт/закрыт)
  - StateFlow для сообщений чата
  - Метод отправки сообщения пользователя
  - Метод генерации ответа питомца
  - Обработка демо-фраз

### 2.3 Замена кнопок эмоций
- **Обновить MainScreen.kt**:
  - Удалить EmotionButtons
  - Добавить одну кнопку "Рассказать"
  - Обработчик открытия чата

### 2.4 Создание модалки изменений
- **Создать `StatsChangeModal.kt`**:
  - Показ изменений шкал после отправки сообщения
  - Анимация изменения значений
  - Автоматическое закрытие через 3 секунды

---

## ЭТАП 3: Демо режим с циклическим переключением

### 3.1 Обновление демо-системы
- **Обновить DemoScenario.kt**:
  - Добавить фразы для эмоции ANGER
  - Создать циклический порядок: JOY → SADNESS → ANGER → CALM
  - Убрать NEUTRAL из демо-цикла

### 3.2 Логика демо-режима в ViewModel
- **Обновить EchoViewModel.kt**:
  - Счетчик текущего демо-этапа (0-3)
  - Метод получения следующей демо-фразы
  - Автоматическое изменение шкал при демо-ответах
  - Сброс цикла после 4-го этапа

### 3.3 Интеграция демо в чат
- **Обновить ChatInterface.kt**:
  - Кнопка "Демо ответ" заполняет поле соответствующей фразой
  - Показать, какая эмоция сейчас в демо (опционально)
  - Автоматический переход к следующему этапу

### 3.4 Финальное тестирование
- Проверка работы всего цикла демо
- Анимации шкал
- Переходы между состояниями питомца
- Модалка изменений после каждого сообщения

---

## Итоговые файлы для изменения:
- `PetState.kt` - новая эмоция ANGER
- `Color.kt` - цвет для злости  
- `EchoViewModel.kt` - логика шкал и демо
- `MainScreen.kt` - замена кнопок на чат
- `DemoScenario.kt` - фразы для ANGER
- **Новые файлы**:
  - `PetStats.kt` - модель состояний
  - `PetStatsBar.kt` - компонент шкал
  - `ChatInterface.kt` - интерфейс чата
  - `StatsChangeModal.kt` - модалка изменений